"use strict";(self.webpackChunk_deathbeds_ipydrawio_pdf=self.webpackChunk_deathbeds_ipydrawio_pdf||[]).push([[385],{656:(t,e,i)=>{i.d(e,{C:()=>s,M:()=>r});var n=i(67);const s=new(i(502).LabIcon)({name:"drawio:pdf",svgstr:n.DRAWIO_ICON_SVG.replace(n.DRAWIO_ICON_CLASS_RE,"jp-icon-contrast2")}),r={ext:".pdf",format:"base64",factoryName:"Diagram (PDF)",icon:s,key:"pdf",label:"PDF",mimetype:"application/pdf",modelName:"base64",name:"pdf",isExport:!0,isBinary:!0,isTransformed:!0,save:n.stripDataURI,exporter:async(t,e,i)=>null}},385:(t,e,i)=>{i.r(e),i.d(e,{default:()=>v});var n=i(33),s=i(583),r=i(67),o=i(656),a=i(271),d=i.n(a);function l(t){const{provisioning:e,provisioned:i,running:n,starting:r}=t;let a=e?"provisioning...":r?"starting...":n?"running":i?"ready":"not provisioned";return d().createElement(s.GroupItem,{spacing:4},d().createElement(s.TextItem,{source:a,title:`Drawio PDF export server is ${a}`}),d().createElement(o.C.react,{stylesheet:"statusBar"}))}class p extends n.VDomRenderer{constructor(t){super(t),this.addClass(s.interactiveItem)}render(){return null==this.model?null:d().createElement(l,{provisioned:this.model.provisioned,running:this.model.running,provisioning:this.model.provisioning,starting:this.model.starting})}}!function(t){class e extends n.VDomModel{constructor(){super(...arguments),this._provisioned=!1,this._running=!1,this._provisioning=!1,this._starting=!1}get provisioned(){return this._provisioned}set provisioned(t){this._provisioned!==t&&(this._provisioned=t,this.stateChanged.emit(void 0))}get running(){return this._running}set running(t){this._running!==t&&(this._running=t,this.stateChanged.emit(void 0))}get starting(){return this._starting}set starting(t){this._starting!==t&&(this._starting=t,this.stateChanged.emit(void 0))}get provisioning(){return this._starting}set provisioning(t){this._provisioning!==t&&(this._provisioning=t,this.stateChanged.emit(void 0))}}t.Model=e}(p||(p={}));var u,c=i(142);class h{constructor(){this.exportPDF=async(t,e,i)=>{await this.fetchStatus();let n=this.exportUrl(i);if(null==n)return null;const s=t.adapter.toXML();n+=n.endsWith("/")?"":"/";const r=new URLSearchParams;r.append("xml",s),r.append("format","pdf"),r.append("base64","1");const o=await fetch(n,{method:"POST",headers:this.defaultHeaders(),body:r.toString()});return o.status>=400?(console.warn("PDF export failed",o),null):`application/pdf;base64,${await o.text()}`},this.status=new p.Model}async fetchStatus(){const t=this.statusUrl();if(null==t)return;const e=await fetch(t,{method:"GET"});if(e.status>=400)return console.warn("Unknown PDF status",e),null;const i=await e.json();this.status.running=i.is_running,this.status.provisioned=i.is_provisioned,this.status.provisioning=i.is_provisioning,this.status.starting=i.is_starting}async provision(){await this.fetchStatus();const t=this.provisionUrl();if(null==t)return;const e=fetch(t,{method:"POST",headers:this.defaultHeaders()});await this.fetchStatus();const i=await e;if(i.status>=400)return console.warn("PDF provision failed",i),null;await this.fetchStatus()}defaultHeaders(){return{"Content-Type":"application/x-www-form-urlencoded","X-XSRFToken":u.getCookie("_xsrf")||""}}exportUrl(t){var e;let i="./ipydrawio/export/";try{i=(null===(e=null==t?void 0:t.composite)||void 0===e?void 0:e.drawioExportUrl).url}catch(t){r.DEBUG&&console.warn("using fallback url",t)}return 0!==i.indexOf("./")?(console.error("don't know how to handle non-relative URLs"),null):`${c.PageConfig.getBaseUrl()}${i.slice(2)}`}statusUrl(){let t="./ipydrawio/status";return 0!==t.indexOf("./")?(console.error("don't know how to handle non-relative URLs"),null):`${c.PageConfig.getBaseUrl()}${t.slice(2)}`}provisionUrl(){let t="./ipydrawio/provision";return 0!==t.indexOf("./")?(console.error("don't know how to handle non-relative URLs"),null):`${c.PageConfig.getBaseUrl()}${t.slice(2)}`}}!function(t){t.getCookie=function(t){const e=document.cookie.match("\\b"+t+"=([^;]*)\\b");return null==e?void 0:e[1]}}(u||(u={}));var g=i(306);const v={activate:function(t,e,i,n){const s=new h;if(i.addFormat(Object.assign(Object.assign({},o.M),{exporter:s.exportPDF})),t.commands.addCommand(g.OF.provision,{label:"Provision Drawio PDF Export Server",execute:async()=>{await s.provision()}}),e.addItem({command:g.OF.provision,category:"Diagram Export"}),n){const t=new p(s.status);n.registerStatusItem(`${g.NS}:status`,{item:t,align:"right",rank:4,isActive:()=>null!=i.activeWidget}),s.fetchStatus().catch(console.warn)}},id:g.Uu,requires:[n.ICommandPalette,r.IDiagramManager],optional:[s.IStatusBar],autoStart:!0}},306:(t,e,i)=>{i.d(e,{sr:()=>a,OF:()=>d,NS:()=>r,iR:()=>s,Uu:()=>o});const n=JSON.parse('{"name":"@deathbeds/ipydrawio-pdf","version":"1.3.0","homepage":"https://ipydrawio.rtfd.io","bugs":{"url":"https://github.com/deathbeds/ipydrawio/issues"},"main":"lib/index.js","files":["{lib,schema,style,src}/**/*.{ts,tsx,eot,gif,html,jpg,js,js.map,json,png,svg,woff2,css}"],"dependencies":{"@jupyterlab/application":"^3.1.0"},"devDependencies":{"@deathbeds/ipydrawio":"^1.3.0","@jupyterlab/builder":"^3.6.1"},"jupyterlab":{"extension":"lib/plugin.js","outputDir":"../../py_packages/ipydrawio-export/_/ipydrawio-pdf","sharedPackages":{"@deathbeds/ipydrawio":{"bundled":false,"singleton":true}},"discovery":{"server":{"base":{"name":"ipydrawio-export"},"managers":["pip","conda"]}}}}'),s=i.t(n,2),r=s.name,o=`${r}:plugin`,a="ipydrawio-pdf";var d;!function(t){t.provision=`${a}:provision`}(d||(d={}))}}]);