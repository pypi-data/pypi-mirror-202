{"version":3,"file":"mod-menu-dev.js","names":["$","MyAMS","_contextMenuHandler","menu","get","tagName","parents","first","menuData","data","toggle","require","then","modal","open","href","attr","amsUrl","startsWith","hrefGetter","core","getFunctionByName","replace","target","form","confirmChangedForm","status","skin","loadURL","location","hash","dom","root","hasClass","removeClass","setTimeout","window","_initialized","init","fn","extend","contextMenu","settings","getMenuPosition","mouse","direction","win","menuSelector","position","each","idx","elt","source","on","evt","ctrlKey","dropdown","css","left","clientX","top","clientY","off","clickEvt","stopPropagation","preventDefault","document","click","currentTarget","ul","children","menuRect","getBoundingClientRect","buttonHeight","height","menuHeight","outerHeight","addClass","focus","clickEvent","env","bundle","config","modules","push","console","debug"],"sources":["mod-menu.js"],"sourcesContent":["/* global MyAMS */\n/**\n * MyAMS menus management\n */\n\nconst $ = MyAMS.$;\n\n\n/**\n * Context menu handler\n */\nfunction _contextMenuHandler(menu) {\n\tif (menu.get(0).tagName !== 'A') {\n\t\tmenu = menu.parents('a').first();\n\t}\n\tconst menuData = menu.data();\n\tif (menuData.toggle === 'modal') {\n\t\tMyAMS.require('modal').then(() => {\n\t\t\tMyAMS.modal.open(menu);\n\t\t});\n\t} else {\n\t\tlet href = menu.attr('href') || menuData.amsUrl;\n\t\tif (!href || href.startsWith('javascript:') || menu.attr('target')) {\n\t\t\treturn;\n\t\t}\n\t\tconst hrefGetter = MyAMS.core.getFunctionByName(href);\n\t\tif (typeof hrefGetter === 'function') {\n\t\t\thref = hrefGetter(menu);\n\t\t}\n\t\tif (typeof href === 'undefined') {\n\t\t\treturn;\n\t\t}\n\t\tif (typeof href === 'function') {\n\t\t\thref(menu);\n\t\t} else {\n\t\t\tMyAMS.require('form', 'skin').then(() => {\n\t\t\t\thref = href.replace(/%23/, '#');\n\t\t\t\tconst target = menu.data('ams-target');\n\t\t\t\tif (target) {\n\t\t\t\t\tMyAMS.form.confirmChangedForm(target).then((status) => {\n\t\t\t\t\t\tif (status !== 'success') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tMyAMS.skin.loadURL(href, target,\n\t\t\t\t\t\t\tmenu.data('ams-link-options'), menu.data('ams-link-callback'));\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tMyAMS.form.confirmChangedForm().then((status) => {\n\t\t\t\t\t\tif (status !== 'success') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (href.startsWith('#')) {\n\t\t\t\t\t\t\tif (href !== location.hash) {\n\t\t\t\t\t\t\t\tif (MyAMS.dom.root.hasClass('mobile-view-activated')) {\n\t\t\t\t\t\t\t\t\tMyAMS.dom.root.removeClass('hidden-menu');\n\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\twindow.location.hash = href;\n\t\t\t\t\t\t\t\t\t}, 50);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\twindow.location.hash = href;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.location = href;\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\n\nlet _initialized = false;\n\n\n/**\n * MyAMS \"menu\" module\n */\nexport const menu = {\n\n\t/**\n\t * Global module initialization.\n\t * This function extends jQuery with a \"contextMenu()\" function, which\n\t * allows to create a new context menu.\n\t */\n\tinit: () => {\n\n\t\tif (_initialized) {\n\t\t\treturn;\n\t\t}\n\t\t_initialized = true;\n\n\t\t$.fn.extend({\n\n\t\t\t/**\n\t\t\t * JQuery context menu constructor\n\t\t\t */\n\t\t\tcontextMenu: function(settings) {\n\n\t\t\t\tfunction getMenuPosition(mouse, direction) {\n\t\t\t\t\tconst\n\t\t\t\t\t\twin = $(window)[direction](),\n\t\t\t\t\t\tmenu = $(settings.menuSelector)[direction]();\n\t\t\t\t\tlet position = mouse;\n\t\t\t\t\t// opening menu would pass the side of the page\n\t\t\t\t\tif (mouse + menu > win && menu < mouse) {\n\t\t\t\t\t\tposition -= menu;\n\t\t\t\t\t}\n\t\t\t\t\treturn position;\n\t\t\t\t}\n\n\t\t\t\treturn this.each((idx, elt) => {\n\n\t\t\t\t\tconst\n\t\t\t\t\t\tsource = $(elt),\n\t\t\t\t\t\tmenu = $(settings.menuSelector);\n\n\t\t\t\t\t// Set flag on menu items\n\t\t\t\t\t$('a', menu).each((idx, elt) => {\n\t\t\t\t\t\t$(elt).data('ams-context-menu', true);\n\t\t\t\t\t});\n\t\t\t\t\tsource.on(\"contextmenu\", function (evt) {\n\t\t\t\t\t\t// return native menu if pressing CTRL key\n\t\t\t\t\t\tif (evt.ctrlKey) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// open menu\n\t\t\t\t\t\tmenu.data('contextmenu-event-source', source)\n\t\t\t\t\t\t\t.dropdown('show')\n\t\t\t\t\t\t\t.css({\n\t\t\t\t\t\t\t\tposition: 'fixed',\n\t\t\t\t\t\t\t\tleft: getMenuPosition(evt.clientX, 'width') - 10,\n\t\t\t\t\t\t\t\ttop: getMenuPosition(evt.clientY, 'height') - 10\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.off('click')\n\t\t\t\t\t\t\t.on('click', (clickEvt) => {\n\t\t\t\t\t\t\t\tclickEvt.stopPropagation();\n\t\t\t\t\t\t\t\tclickEvt.preventDefault();\n\t\t\t\t\t\t\t\tmenu.dropdown('hide');\n\t\t\t\t\t\t\t\t_contextMenuHandler($(clickEvt.target));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t});\n\n\t\t\t\t\t// make sure menu closes on any click\n\t\t\t\t\t$(document).click(() => {\n\t\t\t\t\t\tmenu.dropdown('hide');\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// Automatically set orientation of dropdown menus\n\t\t$(document).on('show.bs.dropdown', '.btn-group', (evt) => {\n\t\t\t// check menu height\n\t\t\tconst\n\t\t\t\tmenu = $(evt.currentTarget),\n\t\t\t\tul = menu.children('.dropdown-menu'),\n\t\t\t\tmenuRect = menu.get(0).getBoundingClientRect(),\n\t\t\t\tposition = menuRect.top,\n\t\t\t\tbuttonHeight = menuRect.height,\n\t\t\t\tmenuHeight = ul.outerHeight();\n\t\t\tif (position > menuHeight && $(window).height() - position < buttonHeight + menuHeight) {\n\t\t\t\tmenu.addClass(\"dropup\");\n\t\t\t}\n\t\t\t// activate first input\n\t\t\t$('input, select, textarea', ul).first().focus();\n\t\t}).on('hidden.bs.dropdown', '.btn-group', (evt) => {\n\t\t\t// always reset after close\n\t\t\t$(evt.currentTarget).removeClass('dropup');\n\t\t});\n\n\t\t$(document).on('hide.bs.dropdown', (evt) => {\n\t\t\tif (evt.clickEvent) {\n\t\t\t\tconst dropdown = $(evt.clickEvent.target).parents('.dropdown-menu');\n\t\t\t\tif (dropdown.data('ams-click-dismiss') === false) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('menu');\n\t} else {\n\t\tMyAMS.menu = menu;\n\t\tconsole.debug(\"MyAMS: menu module loaded...\");\n\t}\n}\n"],"mappings":"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"}