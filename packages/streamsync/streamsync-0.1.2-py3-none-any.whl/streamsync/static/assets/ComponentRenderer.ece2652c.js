import{F as D,_ as A,d as L,i as k,a as b,t as ne,c as h,o as E,b as N,e as v,f as V,u as F,g as z,h as oe,r as P,w as O,j as M,p as S,k as se,l as ae,m as J,v as W,n as re,q as le,s as ce,x as H,y as K,z as X,A as ie,B as de,C as ue,D as pe}from"./index.b898ce3e.js";function U(a){const m=/[\\]?@{([\w\s.]*)}/g;function y(n){const o={};for(let r=0;r<n.length-1;r++){const s=n[r],{componentId:l}=s,{type:e}=a.getComponentById(l);if(e!=="repeater"||r+1>=n.length)continue;const t=n.slice(0,r+1),d=n.slice(0,r+2),{instanceNumber:p}=d.at(-1),x=_(t,"repeaterObject"),I=Object.entries(x),B=_(t,"keyVariable"),w=_(t,"valueVariable");o[B]=I[p][0],o[w]=I[p][1]}return o}function i(n,o){if(n==null)return null;let r;const s=y(o),l=n.replace(m,(t,d)=>{if(t.charAt(0)=="\\")return t.substring(1);const p=d.trim();if(!p)return;const x=a.evaluateExpression(p,s);if(typeof x!="undefined"){if(p===t){r=x;return}return typeof x=="object"?JSON.stringify(x):x}});return typeof r=="undefined"?l:r}function u(n){const{componentId:o}=n.at(-1),r=a.getComponentById(o);if(!r)return;const s={},{fields:l}=a.getComponentDefinition(r.type);if(!!l)return Object.keys(l).forEach(e=>{s[e]=_(n,e)}),s}function _(n,o){var x;const{componentId:r}=n.at(-1),s=a.getComponentById(r),{fields:l}=a.getComponentDefinition(s.type),e=(x=s.content)==null?void 0:x[o],t=l[o].default,d=i(e,n),p=l[o].type;if(p==D.Object||p==D.KeyValue){if(!d)return t?JSON.parse(t):null;if(typeof d!="string")return d;let I;try{I=JSON.parse(d)}catch{return t?JSON.parse(t):null}return I}else if(p==D.Number){const I=parseFloat(d);return typeof I===void 0||Number.isNaN(I)?parseFloat(t):I}else if(p==D.Text||D.Color)return typeof e=="undefined"||e===null||e===""?t:d}return{getEvaluatedFields:u}}const ve={class:"ChildlessPlaceholder"},_e={class:"content"},me={class:"title"},fe={key:0,class:"message"},ge=L({__name:"ChildlessPlaceholder",props:{componentId:null},setup(a){const m=a,y=10,i=k(b.core),{componentId:u}=ne(m),_=h(()=>i.getComponentById(u.value)),n=h(()=>i.getComponentDefinition(_.value.type)),o=(s,l)=>{const t=s.map(p=>i.getComponentDefinition(p)).map(p=>p==null?void 0:p.name);return`${t.slice(0,-1).join(", ")} ${t.length>1?l:""} ${t.at(-1)}`},r=h(()=>{const s=i.getContainableTypes(u.value);let l;return s.length<=y&&(l=`You can add ${o(s,"and")} components`),l});return(s,l)=>(E(),N("div",ve,[v("div",_e,[v("div",me,[v("h2",null,"Empty "+V(F(n).name),1)]),F(r)?(E(),N("div",fe,V(F(r)),1)):z("",!0)])]))}});var he=A(ge,[["__scopeId","data-v-0ac82581"]]);const ye=a=>M("div",`Component type ${a} not supported.`),Ce={props:["componentId","instancePath","instanceData"],setup(a){const m=k(b.core),y=k(b.builderManager),i=a.componentId,u=h(()=>m.getComponentById(i)),_=oe[u.value.type];if(!_)return ye(u.value.type);const n=a.instancePath,o=a.instanceData,r=U(m),s=h(()=>r.getEvaluatedFields(n)),l=h(()=>m.getComponents(i,!0)),e=h(()=>!!y&&y.getMode()!="preview"),t=()=>{if(!(l.value.length>0))return M(he,{componentId:u.value.id})},d=(c,g=0)=>M(q,{componentId:c,key:`${c}:${g}`,instancePath:[...n,{componentId:c,instanceNumber:g}],instanceData:[...o,P(null)]}),p=(c=0,g=()=>!0,f=!1)=>{const C=T=>M("div",{"data-streamsync-slot-of-id":i,"data-streamsync-position":T}),$=e.value&&!f,j=l.value.filter(g).map((T,te)=>[d(T.id,c),...$?[C(te+1)]:[]]);return[...$?[C(0)]:[]].concat(j.flat())};S(b.evaluatedFields,s),S(b.componentId,i),S(b.isBeingEdited,e),S(b.instancePath,n),S(b.instanceData,o),S(b.renderProxiedComponent,d),S(b.getChildrenVNodes,p);const I={"data-streamsync-id":i,"data-streamsync-instance-path":(c=>c.map(g=>`${g.componentId}:${g.instanceNumber}`).join(","))(n)},B=P(!1);O(()=>(y==null?void 0:y.getSelectedId())==i,c=>{B.value=c}),O(s,()=>{B.value=!1});const w=h(()=>l.value.length==0),G=h(()=>m.isComponentVisible(i)),Y=c=>{if(!c.startsWith("$"))return f=>m.forwardEvent(f,n);if(c.startsWith("$goToPage_")){const f=c.substring(10);return C=>m.setActivePageFromKey(f)}return null},Q=h(()=>{var g;const c={};if(u.value.binding){const f=u.value.binding.eventType,C=`on${f.charAt(0).toUpperCase()}${f.slice(1)}`;c[C]=$=>m.forwardEvent($,n)}return Object.entries((g=u.value.handlers)!=null?g:{}).forEach(([f,C])=>{const $=`on${f.charAt(0).toUpperCase()}${f.slice(1)}`;c[$]=Y(C)}),c}),Z=h(()=>{var f;const c=(f=m.getComponentDefinition(u.value.type))==null?void 0:f.fields;if(!c)return;const g={};return Object.keys(c).forEach(C=>{!c[C].applyStyleVariable||!s.value[C]||(g[`--${C}`]=s.value[C])}),g}),ee=function(){return{class:{component:!0,childless:w.value,selected:B.value},style:{...Z.value,...G.value?{}:{display:"none"}},...I,...Q.value,draggable:e.value}};return()=>{const c=e.value?t():void 0,g=({instanceNumber:$,componentFilter:j,positionlessSlot:T})=>w.value?T?void 0:c:p($,j,T),f={...ee()};return M(_,f,{default:g})}}};var q=A(Ce,[["__scopeId","data-v-4d94d3d8"]]);const R=a=>(K("data-v-2ef8a086"),a=a(),X(),a),Ie=R(()=>v("i",{class:"ri-notification-2-line ri-xl"},null,-1)),be={class:"counter"},xe=R(()=>v("div",{class:"balloonFlash"},null,-1)),$e={class:"main"},Se=R(()=>v("i",{class:"ri-close-line"},null,-1)),Ee=R(()=>v("i",{class:"ri-error-warning-fill ri-xl"},null,-1)),Te=[Ee],Ve={class:"content"},Ne={class:"title"},Pe={class:"time"},Be={class:"message"},De=L({__name:"RendererNotifications",setup(a){const y=k(b.core),i=P(!1),u=P(null),_=se([]),n=s=>{const{type:l,title:e,message:t,code:d}=s;_.unshift({type:l,title:e,message:t,code:d,timestampReceived:new Date}),_.splice(100),u.value.classList.remove("alert"),u.value.offsetWidth,u.value.classList.add("alert")};ae(()=>{y.addMailSubscription("notification",n)});const o=()=>{_.length!=0&&(i.value=!i.value)},r=()=>{_.splice(0),i.value=!1};return(s,l)=>J((E(),N("div",{class:"RendererNotifications",onClick:o},[v("div",{class:"balloon",ref_key:"balloon",ref:u,title:"Toggle notifications"},[Ie,v("div",be,V(_.length),1)],512),xe,J(v("div",$e,[v("div",{class:"clearContainer"},[v("button",{onClick:r},[Se,re(" Clear all ")])]),(E(!0),N(le,null,ce(_,(e,t)=>(E(),N("div",{class:"notification",key:t},[v("div",{class:H(["icon",e.type])},Te,2),v("div",Ve,[v("header",null,[v("strong",Ne,V(e.title),1),v("span",Pe,V(e.timestampReceived.toLocaleTimeString()),1)]),v("div",Be,V(e.message),1)])]))),128))],512),[[W,i.value]])],512)),[[W,_.length>0]])}});var Me=A(De,[["__scopeId","data-v-2ef8a086"]]);const Fe=a=>(K("data-v-4b606cac"),a=a(),X(),a),ke=Fe(()=>v("div",{class:"loadingBar"},null,-1)),we={class:"rootComponentArea"},Ae=L({__name:"ComponentRenderer",setup(a){const m=k(b.core),y=U(m),i=m.getComponents();i.length==0&&console.error("No pages found.");const u=[{componentId:"root",instanceNumber:0}],_=[P(null)],n=P(i[0]),o=h(()=>y.getEvaluatedFields(u)),r=h(()=>({"--accentColor":o.value.accentColor,"--emptinessColor":o.value.emptinessColor,"--containerBackgroundColor":o.value.parentIdBackgroundColor,"--primaryTextColor":o.value.primaryTextColor,"--secondaryTextColor":o.value.secondaryTextColor,"--separatorColor":o.value.separatorColor})),s=h(()=>m.isMessagePending.value);O(()=>o.value.appName,e=>{l(e)},{immediate:!0});function l(e){const t=m.getMode();let d;e&&t=="edit"?d=`${e} | Streamsync Builder`:!e&&t=="edit"?d="Streamsync Builder":e&&t=="run"?d=`${e}`:!e&&t=="run"&&(d="Streamsync App"),document.title=d}return(e,t)=>(E(),N("div",{class:H(["ComponentRenderer",{loadingActive:F(s)}]),tabindex:"-1",style:pe(F(r))},[ie(Me,{class:"notifications"}),ke,v("div",we,[n.value?(E(),de(q,{key:0,"component-id":n.value.id,"instance-path":u,"instance-data":_},null,8,["component-id"])):z("",!0),ue(e.$slots,"default",{},void 0,!0)])],6))}});var Oe=A(Ae,[["__scopeId","data-v-4b606cac"]]);export{Oe as default};
