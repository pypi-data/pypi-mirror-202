"use strict";(self.webpackChunkroboweb_extension=self.webpackChunkroboweb_extension||[]).push([[568],{568:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var o=n(33),l=(n(169),n(123)),c=n(832);class i extends c.Widget{constructor(){super(),this.id="assistant-panel",this.addClass("assistant-panel"),this.title.caption="Assistant",this.title.iconClass="fa fa-robot"}}function r(e,t){var n=e();null!==n?t(n):setTimeout((function(){r(e,t)}),100)}function s(e,t){const n=function(e,t){const n=[];if(0===e.length)return t.length;if(0===t.length)return e.length;for(let e=0;e<=t.length;e++)n[e]=[e];for(let t=0;t<=e.length;t++)n[0][t]=t;for(let o=1;o<=t.length;o++)for(let l=1;l<=e.length;l++)t.charAt(o-1)===e.charAt(l-1)?n[o][l]=n[o-1][l-1]:n[o][l]=Math.min(n[o-1][l-1]+1,Math.min(n[o][l-1]+1,n[o-1][l]+1));return n[t.length][e.length]}(e,t),o=Math.max(e.length,t.length);return(o-n)/o}function a(e){var t="";const n=e.outputArea.model.toJSON();if(n.length>0){const e=n[0].traceback;if(null!=e)for(var o=0;o<e.length;o++){const n=/\x1B\[([0-9]{1,2}(;[0-9]{1,2})?)?[m|K]/g;t+=e[o].replace(n,"")+"\n"}else t=n[0].text}return{text:e.model.value.text,output:t}}function u(){window.isJupyter=!0;const e=document.createElement("script");e.src="/roboweb-server-extension/flutter.js",document.head.appendChild(e),e.onload=function(){console.log("Downloading main.dart.js"),_flutter.loader.loadEntrypoint({serviceWorker:{serviceWorkerVersion:"124778936"}}).then((function(e){console.log("Initializing engine"),r((function(){return document.getElementById("assistant-panel")}),(function(t){e.initializeEngine({hostElement:t}).then((function(e){return e.runApp()}))}))}))}}const d={id:"roboweb-extension",requires:[l.INotebookTracker,o.ICommandPalette,o.IThemeManager],activate:(e,t,n,o)=>{console.log("Roboweb extension activated v0.1");const c=new i;c.node.style.minWidth="450px",e.shell.add(c,"right",{rank:0}),window.enableThemeSync=!0,o.themeChanged.connect(((e,t)=>{window.enableThemeSync?(console.log("Theme changed to "+t.newValue),window.changeThemeFlutter(t.newValue)):window.enableThemeSync=!0})),window.getCurrentJupyterTheme=function(){return console.log("Current theme is "+o.theme),o.theme},window.changeThemeJupyter=function(e){console.log("Changing theme to "+e),o.setTheme(e),window.enableThemeSync=!1},window.currentCellText=function(){return function(e,t){const n=e.currentWidget;if(n)return-1===n.content.activeCellIndex?"":a(t.shell.currentWidget.content.activeCell)}(t,e)},window.replaceCodeCurrentCell=function(e){!function(e,t){const n=e.currentWidget;if(n){t=t.trim();for(var o=0,l=-1,c=0;c<n.content.model.cells.length;c++){const e=s(n.content.model.cells.get(c).value.text,t);e>o&&(o=e,l=c)}if(o>.8)console.log("Replacing code in cell "+l),n.content.model.cells.get(l).value.text=t;else{console.log("Adding new cell");const e=n.content.activeCellIndex;if(t.startsWith("!")){const e=n.content.model.contentFactory.createCodeCell({});e.value.text=t,n.content.model.cells.insert(0,e),console.log("Adding new cell at the beginning")}else if(-1!=e&&0==n.content.model.cells.get(e).value.text.trim().length)console.log("Replacing code in current cell"),n.content.model.cells.get(e).value.text=t;else{const e=n.content.model.contentFactory.createCodeCell({});e.value.text=t,n.content.model.cells.push(e)}}}}(t,e)},window.runAll=function(){const e=t.currentWidget;e&&l.NotebookActions.runAll(e.content,e.sessionContext)},l.NotebookActions.executed.connect((async(e,t)=>{const{cell:n,notebook:o,success:l,error:c}=t;var i=a(n);const r=i.text,s=i.output;console.log("Logging execution"+r+" "+s),window.logCellExecution(i.text,i.output),c&&(console.log("Error executing cell"),window.autoPrompt(i.text,i.output))})),e.commands.addCommand("fix-cell-extension:fixCell",{label:"Fix",execute:()=>{if(console.log("Fixing cell"),!t.currentWidget)return void console.log("No notebook open");const e=window.currentCellText(),n="My code has an error. Ideally give me a quick command to fix it. If that's not available give me python code to fix it. Assume i dont have a credentials or key file. \n\nCode: \n\n"+e.text+"\n\nError: \n\n"+e.output;console.log("Pasting prompt "+n),window.pastePrompt(n)}}),e.contextMenu.addItem({command:"fix-cell-extension:fixCell",selector:".jp-Notebook",rank:0}),window.addEventListener("click",(function(e){document.querySelector("#assistant-panel").contains(e.target)||removeFocus()}),{passive:!0}),u()},autoStart:!0}}}]);