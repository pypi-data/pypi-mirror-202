"use strict";(self.webpackChunkroboweb_extension=self.webpackChunkroboweb_extension||[]).push([[568],{568:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var o=n(33),r=(n(169),n(123)),l=n(832);class c extends l.Widget{constructor(){super(),this.id="assistant-panel",this.addClass("assistant-panel"),this.title.caption="Assistant",this.title.iconClass="fa fa-robot"}}function i(e,t){var n=e();null!==n?t(n):setTimeout((function(){i(e,t)}),100)}function s(e,t){const n=function(e,t){const n=[];if(0===e.length)return t.length;if(0===t.length)return e.length;for(let e=0;e<=t.length;e++)n[e]=[e];for(let t=0;t<=e.length;t++)n[0][t]=t;for(let o=1;o<=t.length;o++)for(let r=1;r<=e.length;r++)t.charAt(o-1)===e.charAt(r-1)?n[o][r]=n[o-1][r-1]:n[o][r]=Math.min(n[o-1][r-1]+1,Math.min(n[o][r-1]+1,n[o-1][r]+1));return n[t.length][e.length]}(e,t),o=Math.max(e.length,t.length);return(o-n)/o}function a(e){var t="";const n=e.outputArea.model.toJSON();if(n.length>0){const e=n[0].traceback;if(null!=e)for(var o=0;o<e.length;o++){const n=/\x1B\[([0-9]{1,2}(;[0-9]{1,2})?)?[m|K]/g;t+=e[o].replace(n,"")+"\n"}else t=n[0].text}return{text:e.model.value.text,output:(r=t,r.replace(/\x1B(?:[@-Z\\-_]|\[[0-?]*[ -/]*[@-~])/g,""))};var r}function u(){window.isJupyter=!0,window.serviceWorkerVersion="124778936";const e=document.createElement("script");e.src="/roboweb-server-extension/flutter.js",document.head.appendChild(e),e.onload=function(){console.log("Downloading main.dart.js"),_flutter.loader.loadEntrypoint({serviceWorker:{serviceWorkerVersion}}).then((function(e){console.log("Initializing engine"),i((function(){return document.getElementById("assistant-panel")}),(function(t){e.initializeEngine({hostElement:t}).then((function(e){return e.runApp()}))}))}))}}const d={id:"roboweb-extension",requires:[r.INotebookTracker,o.ICommandPalette,o.IThemeManager],activate:(e,t,n,o)=>{console.log("Roboweb extension activated v0.1");const l=new c;l.node.style.minWidth="450px",e.shell.add(l,"right",{rank:0}),window.enableThemeSync=!0,o.themeChanged.connect(((e,t)=>{window.enableThemeSync?window.changeThemeFlutter(t.newValue):window.enableThemeSync=!0})),window.getCurrentJupyterTheme=function(){return o.theme},window.changeThemeJupyter=function(e){o.setTheme(e),window.enableThemeSync=!1},window.currentCellText=function(){return function(e,t){const n=e.currentWidget;if(n)return-1===n.content.activeCellIndex?"":a(t.shell.currentWidget.content.activeCell)}(t,e)},window.replaceCodeCurrentCell=function(e){!function(e,t){const n=e.currentWidget;if(!n)return;var o=0,r=-1,l=-1,c=-1;const i=(t=t.trim()).split("\n").filter((function(e){return!e.startsWith("#")})).join("\n");for(var a=0;a<n.content.model.cells.length;a++){const e=n.content.model.cells.get(a).value.text;if(e.includes(i))return;0==e.trim().length&&(l=a);const u=s(e,t);u>o&&(o=u,r=a),e.startsWith("!")&&(c=a)}if(o>.8)n.content.model.cells.get(r).value.text=t;else if(t.startsWith("!")){const e=n.content.model.contentFactory.createCodeCell({});e.value.text=t,n.content.model.cells.insert(0,e)}else if(t.startsWith("%")&&!t.startsWith("%%")){const e=n.content.model.contentFactory.createCodeCell({});e.value.text=t,n.content.model.cells.insert(c+1,e)}else if(-1!=l)n.content.model.cells.get(l).value.text=t;else{const e=n.content.model.contentFactory.createCodeCell({});e.value.text=t,n.content.model.cells.push(e)}}(t,e)},window.runAll=function(){const e=t.currentWidget;e&&r.NotebookActions.runAll(e.content,e.sessionContext)},r.NotebookActions.executed.connect((async(e,t)=>{const{cell:n,notebook:o,success:r,error:l}=t;var c=a(n);const i=c.text,s=c.output;if(!r){window.lastArgs=t;const e=l.errorName+": "+l.errorValue;window.logCellExecution(c.text,c.output),window.autoPrompt(e,i,s)}})),e.commands.addCommand("fix-cell-extension:fixCell",{label:"Fix",execute:()=>{if(!t.currentWidget)return;const e=window.currentCellText(),n="My code has an error. \n\nCode: \n\n"+e.text+"\n\nError: \n\n"+e.output;window.pastePrompt(n)}}),e.contextMenu.addItem({command:"fix-cell-extension:fixCell",selector:".jp-Notebook",rank:0}),window.addEventListener("click",(function(e){document.querySelector("#assistant-panel").contains(e.target)||removeFocus()}),{passive:!0}),u()},autoStart:!0}}}]);